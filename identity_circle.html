<!DOCTYPE html>
<meta charset="utf-8">
<style>
  circle_svg {
    width: 120%;
    height: 100%;
  }

  path.slice {
    stroke-width: 2px;
    transition: transform 0.3s ease;
  }

  polyline {
    opacity: 0.5;
    stroke: #CC2936;
    stroke-width: 3px;
    fill: none;
  }

  .tooltip {
    position: absolute;
    padding: 5px;
    background-color: #EEABC4;
    color: black;
    border-radius: 5px;
    pointer-events: none;
    opacity: 0;
  }
</style>

<body>

  <h1 id="title">Default Title</h1>

  <button onclick="updateData(lgbtq_data, 'Do you identify as LGBTQ+ in any form?')">Proportion LGBTQ+</button>
  <button onclick="updateData(transgender_data, 'Do you identify as transgender?')">Proportion Transgender</button>

  <div id="circle_charts"></div>
  <div class="tooltip" id="tooltip"></div>

  <script src="https://d3js.org/d3.v7.js"></script>

  <script>
    var width = 960;
    var height = 500;
    var radius = Math.min(width, height) / 2;

    var circle_svg = d3.select("#circle_charts")
      .append("svg")
      .attr("width", width)
      .attr("height", height)
      .append("g")
      .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

    var color = d3.scaleOrdinal()
      .domain(["Yes", "No", "Unsure", "No Response"])
      .range(["#08415C", "#6B818C", "#F1BF98", "#EEE5E9"]); //#CC2936 lines

    var lgbtq_data = [
      {response: "No", value: 10},
      {response: "Unsure", value: 7.2},
      {response: "No Response", value: 1.4},
      {response: "Yes", value: 81.4}
    ];

    var transgender_data = [
      {response: "Yes", value: 25.1},
      {response: "No Response", value: 2.6},
      {response: "Unsure", value: 8.3},
      {response: "No", value: 64}
    ];

    var pie = d3.pie()
      .value(function(d) { return d.value; })
      .sort(null);

    var arc = d3.arc()
      .outerRadius(radius * 0.8)
      .innerRadius(radius * 0.4);

    var tooltip = d3.select("#tooltip");

    function updateData(data, title) {
      d3.select("#title").text(title);

      var data_ready = pie(data);

      circle_svg.selectAll("*").remove(); 

      circle_svg.append("circle")
        .attr("cx", 0)
        .attr("cy", 0)
        .attr("r", radius)
        .style("fill", "white")
        .style("stroke", "none");

      var u = circle_svg.selectAll("path.slice")
        .data(data_ready);

      u.enter()
        .append('path')
        .merge(u)
        .attr('d', arc)
        .attr('fill', function(d) { return color(d.data.response); })
        .attr("stroke", "white")
        .style("stroke-width", "2px")
        .style("opacity", 1)
        .on("mouseover", function(event, d) {
          tooltip.transition().duration(200).style("opacity", 1);
          tooltip.html(d.data.response + ": " + d.data.value + "%")
            .style("left", (event.pageX + 5) + "px")
            .style("top", (event.pageY - 28) + "px");

          d3.select(this).transition().duration(300).attr("transform", "scale(1.1)");
        })
        .on("mouseout", function(d) {
          tooltip.transition().duration(200).style("opacity", 0);

          d3.select(this).transition().duration(300).attr("transform", "scale(1)");
        });

      var text = circle_svg.selectAll("text")
        .data(data_ready);

      text.enter()
        .append("text")
        .merge(text)
        .attr("transform", function(d) {
          var pos = arc.centroid(d);
          pos[0] = radius * (midAngle(d) < Math.PI ? 1 : -1);
          pos[1] -= 10;  
          return "translate(" + pos + ")";
        })
        .style("text-anchor", function(d) {
          return midAngle(d) < Math.PI ? "start" : "end";
        })
        .text(function(d) { return d.data.response; });

      var polyline = circle_svg.selectAll("polyline")
        .data(data_ready);

      polyline.enter()
        .append("polyline")
        .merge(polyline)
        .attr("points", function(d) {
          var pos = arc.centroid(d);
          var outerPos = arc.centroid(d);
          outerPos[0] = radius * 0.95 * (midAngle(d) < Math.PI ? 1 : -1);
          outerPos[1] -= 10;  
          return [pos, outerPos];
        });
    }
  
    function midAngle(d) {
      return d.startAngle + (d.endAngle - d.startAngle) / 2;
    }
    updateData(lgbtq_data, 'Do you identify as LGBTQ+ in any form?');
  </script>

</body>
</html>
